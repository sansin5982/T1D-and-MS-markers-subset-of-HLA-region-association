---
title: "T1D_MS"
author: "Sandeep Singh"
date: "14/01/2021"
output: 
   html_document:
    keep_md: true
always_allow_html: true
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
```


```{r}
# This document depends on the following packages:
library(rlang)
library(dplyr)
library(tibble)
library(readxl)
library(DT)
library(tidyr)
library(data.table)
library(ggplot2)
library(ggrepel)
library(forcats)
library(scales)
library(grid)
library(purrr) # to append multiple dataframes
library(plotly)
library(VennDiagram)
library(RColorBrewer)
library(png)
```

* raw_data.txt file was generated from previous researches on Type-1-diabetes and multiple sclerosis.  
* This file contains only 119 SNPs as common markers for T1D and MS. 

## File preparation
```{r}
T1D_MS_original_119 <- read.table("C:/SANDEEP/MAIN/CAREER/My_papers/PAPERS_in_PROGRESS/T1D_MS/T1D_MS_new/T1D.txt",
                                  header = F) 

knitr::kable(T1D_MS_original_119[1:5, ], align = "lccrr", col.names = c('SNP'), caption = "Table representing SNPs associated with T1D and MS.")
```

* A total of 119 SNPs.
* This file was used to create ANNOVAR formatted file.

### File preparation by ANNOVAR
* Command used in ANNOVAR: 

convert2annovar.pl -format rsid T1D.txt -dbsnpfile humandb/hg19_snp138.txt > T1D_MS_formatted

* 119 SNPs records input; 110 SNPs records as output, 9 SNPs missing

```{r}
# duplicate SNPs due to HLA region were removed from ANNOVAR file
T1D_MS_original_110 <- read.table("C:/SANDEEP/MAIN/CAREER/My_papers/PAPERS_in_PROGRESS/T1D_MS/T1D_MS_new/T1D_MS_formatted.txt",
                                  header = F)
knitr::kable(T1D_MS_original_110[1:5, ], align = "lccrr", caption = "SNPs run in ANNOVAR.")
```

* Identify 9 missing SNPs

```{r}
# Chekcing difference of SNPs in T1D_MS_original_119 file and T1D_MS_original_110 file

setdiff(T1D_MS_original_119$SNP, T1D_MS_original_110$V6)
```

* missing SNP IDs were renamed from PUBMED

      rs6931717 > rs3095345
      
      rs7452756 > rs4516988
      
      rs12199773 > rs3130952
      
      rs6937967 >  rs3130534
      
      rs12178292 > rs2844558
      
      rs10456058 >  rs2734573
      
      rs7382662 >  rs3129305
      
      rs10807118 >  rs3130578
      
      rs10947377 > rs3130179
      
* Created a new file T1D_2.txt after chainging SNP ids
* Rerun in ANNOVAR and obtained results for all 119 SNPs 

```{r}
T1D_MS_new_119 <- read.table("file:///C:/SANDEEP/MAIN/CAREER/My_papers/PAPERS_in_PROGRESS/T1D_MS/T1D_MS_new/T1D_MS_formatted_2.txt", 
                             header = F)

knitr::kable(T1D_MS_new_119[1:5, ], align = "lccrr", caption = "SNP added with 9 missing data.")
```

# ANNOVAR ANALYSIS

## Gene based annotation

### Known Gene (UCSC)
```{r}
Known_T1D <- read.table("C:/SANDEEP/MAIN/CAREER/My_papers/PAPERS_in_PROGRESS/T1D_MS/T1D_MS_new/ANNOVAR_RESULTS/Gene_based/Known_gene_T1D.variant_function", header = F)
colnames(Known_T1D) <- c("Genomic region", "Gene", "Chromosome", "BP_1", "BP_2", "A1", "A2", "SNP") 

knitr::kable(Known_T1D[1:5, ], align = "lccrr", col.names = c("Genomic region", "Gene", "Chromosome", "BP_1", "BP_2", "A1", "A2", "SNP"), caption = "Table representing SNPs information from known gene.")

Known_T1D$BP_1 <- as.character(Known_T1D$BP_1)
```

### Ensembel Gene
```{r}
Ens_T1D <- read.table("C:/SANDEEP/MAIN/CAREER/My_papers/PAPERS_in_PROGRESS/T1D_MS/T1D_MS_new/ANNOVAR_RESULTS/Gene_based/Ens_gene_T1D.variant_function", header = F)

knitr::kable(Ens_T1D[1:5, ], align = "lccrr", col.names = c("Genomic region", "Gene", "Chromosome", "BP_1", "BP_2", "A1", "A2", "SNP"), caption = "Table representing SNPs information from Ensemble gene.")
```      

### Ref Gene (NCBI)
```{r}
Ref_T1D <- read.table("C:/SANDEEP/MAIN/CAREER/My_papers/PAPERS_in_PROGRESS/T1D_MS/T1D_MS_new/ANNOVAR_RESULTS/Gene_based/Ref_gene_T1D.variant_function", header = F)

knitr::kable(Ref_T1D[1:5, ], align = "lccrr", col.names = c("Genomic region", "Gene", "Chromosome", "BP_1", "BP_2", "A1", "A2", "SNP"), caption = "Table representing SNPs information from Reference gene.")
```

## Region based annotation

### Conserved genomic elements annotation
```{r}
Con_GE <- fread("file:///C:/SANDEEP/MAIN/CAREER/My_papers/PAPERS_in_PROGRESS/T1D_MS/T1D_MS_new/ANNOVAR_RESULTS/Region_based/T1D_consgenele.hg19_phastConsElements46way") %>%
  separate(V2, c("Con_Sequence_score", "LOD"), sep = ";") %>% 
  rename(SNP = V8) %>% 
  select(Con_Sequence_score, SNP)


knitr::kable(Con_GE, align = "lccrr", caption = "Conserved Genomic Score from NCBI database.")
```

* In evolutionary biology, conserved sequences are identical or similar sequences in nucleic acids (DNA and RNA) or proteins across species (orthologous sequences), or within a genome (paralogous sequences), or between donor and receptor taxa (xenologous sequences). Conservation indicates that a sequence has been maintained by natural selection.


# RegulomeDB results
```{r}
# RegulomeDB files were downloaded from RegulomeDB database
# Reading multiple files in R for regulomeDB analysis
# path <- setwd("C:/SANDEEP/MAIN/CAREER/My_papers/PAPERS_in_PROGRESS/T1D_MS/T1D_MS_new/RegulomeDB_Results")
# file.list <- list.files(path = ".", pattern = "*xlsx")
# RDB.list <- lapply(file.list, read_excel)
```

```{r}
# RDB_T1D <- bind_rows(RDB.list, .id = "id") %>% 
#   rename(Regulome_DB = "RDB_score")

# write.table(RDB_T1D, file = "RegulomeDB_score.txt",
#             sep = "\t",
#             row.names = FALSE,
#             col.names = TRUE,
#             quote = FALSE)
```

```{r}
RDB_T1D <- fread("C:/SANDEEP/MAIN/CAREER/My_papers/PAPERS_in_PROGRESS/T1D_MS/T1D_MS_new/RegulomeDB_Results/RegulomeDB_score.txt")

knitr::kable(RDB_T1D[1:5, ], align = "lccrr", caption = "RegulomeDB score.")
```

```{r}
table(RDB_T1D$RDB_score)
```

Figure Bar chart representing RegulomeDB score
```{r, fig.align="center", fig.width=6, fig.height=6, fig.cap="Figure 1: Bar chart representing RegulomeDB score"}
ggplot(RDB_T1D, aes(x = RDB_score, fill = RDB_score))+
  geom_bar()+
  labs(x = "RegulomeDB score", y = "Total number of SNPs")+
  theme_classic()+
  theme(legend.position = "none")
```

